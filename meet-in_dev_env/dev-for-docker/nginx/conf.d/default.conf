  server{
    listen       443 ssl;
    server_name 127.0.0.1;

    index index.php index.html index.htm;
    client_max_body_size 1G;

    ssl_certificate /etc/nginx/ssl/cert/localhost+1.pem;
    ssl_certificate_key /etc/nginx/ssl/cert/localhost+1-key.pem;

    ### WebSocket Proxy設定 ###
    location /ws/ {
      proxy_pass http://host.docker.internal:4567;
      proxy_http_version 1.1;

      # 360Sec(6分)
      keepalive_timeout 360;
      # 指定回数リクエストを受けると終了します
      keepalive_requests 500000;
      # プロキシされたサーバーからの応答を読み取るためのタイムアウトを定義します。
      # タイムアウトは、応答全体の送信ではなく、2つの連続する読み取り操作の間にのみ設定されます。
      # プロキシサーバーがこの時間内に何も送信しない場合、接続は閉じられます。
      # デフォルトは60秒です。
      proxy_read_timeout 36000s;
      # プロキシされたサーバーにリクエストを送信するためのタイムアウトを設定します。
      # タイムアウトは、リクエスト全体の送信ではなく、2つの連続する書き込み操作の間にのみ設定されます。
      # プロキシサーバーがこの時間内に何も受信しない場合、接続は閉じられます。
      # デフォルトは60秒です。
      proxy_send_timeout 36000s;
      
      proxy_set_header Upgrade $http_upgrade;
      proxy_set_header Connection "upgrade";
    }

    ### Apache 設定 ###
    location / {
        proxy_redirect   off;
        proxy_set_header Host               $http_host;
        proxy_set_header X-Real-IP          $remote_addr;
        proxy_set_header X-Forwarded-Host   $host;
        proxy_set_header X-Forwarded-Server $host;
        proxy_set_header X-Forwarded-For    $proxy_add_x_forwarded_for;

        proxy_read_timeout 360;
        proxy_pass  http://host.docker.internal:8003;
        break;
    }

    location /room/null {
        return 404;
    }

    ### PHP Proxy ###
    location ~ \.php$ {
        proxy_redirect   off;
        proxy_set_header Host               $http_host;
        proxy_set_header X-Real-IP          $remote_addr;
        proxy_set_header X-Forwarded-Host   $host;
        proxy_set_header X-Forwarded-Server $host;
        proxy_set_header X-Forwarded-For    $proxy_add_x_forwarded_for;

        proxy_read_timeout 360;
        proxy_pass  http://host.docker.internal:8003;
        break;
    }
}